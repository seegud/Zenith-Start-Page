<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zenith Start Page</title>
  <link rel="icon" type="image/png" href="https://img.icons8.com/?size=100&id=c9xXfpS6QWwx&format=png&color=000000">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script>
    // Set theme on initial load to prevent FOUC (Flash of Unstyled Content)
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark')
    } else {
      document.documentElement.classList.remove('dark')
    }
  </script>
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>
</head>
<body class="bg-white dark:bg-gray-900">
  <div id="root"></div>
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useCallback, useRef } from 'react';
    import ReactDOM from 'react-dom/client';

    // =================================================================================
    // START: components/Icons.tsx
    // =================================================================================
    const SunIcon = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-6.364-.386l1.591-1.591M3 12h2.25m.386-6.364l1.591 1.591M12 12a6 6 0 100 12 6 6 0 000-12z" />
      </svg>
    );

    const MoonIcon = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
        <path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25c0 5.385 4.365 9.75 9.75 9.75 2.572 0 4.92-.99 6.752-2.648z" />
      </svg>
    );

    const UploadIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
        </svg>
    );

    const BingIcon = ({ className }) => (
        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" className={className || "w-6 h-6"} fill="currentColor">
            <title>Bing</title>
            <path d="M12.455 23.999l-5.35-5.525-5.334 1.744L1.77 12 0 4.026l6.985 2.53L12.455 0l5.467 6.556L24 4.026 22.23 12l-1.77 8.218-5.335-1.744-5.467 5.525.792-6.525-5.467-5.598h13.344l-5.467 5.598.793 6.525z"/>
        </svg>
    );

    const SearchIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
    );

    const GoogleIcon = ({ className }) => (
        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" className={className || "w-6 h-6"} fill="currentColor">
            <title>Google</title>
            <path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-5.107 2.4-4.267 0-7.733-3.5-7.733-7.733s3.467-7.733 7.733-7.733c2.347 0 3.867 1.04 4.733 1.867l2.8-2.8C18.6 1.867 15.9.933 12.48.933c-6.4 0-11.52 5.12-11.52 11.52s5.12 11.52 11.52 11.52c6.4 0 11.52-5.12 11.52-11.52 0-.747-.067-1.467-.133-2.133H12.48z"/>
        </svg>
    );

    const PartlyCloudyIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M12 2.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0112 2.25zM18.75 6a.75.75 0 01.53 1.28l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06a.75.75 0 01.53-.28zM21.75 12a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 01.75.75z" />
        </svg>
    );

    const CloudyIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
        </svg>
    );

    const RainIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
          <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 21a1.5 1.5 0 003 0m-10.5-9A4.5 4.5 0 005.25 6H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 12z" />
          <path strokeLinecap="round" strokeLinejoin="round" d="M10.5 15.75l-1.5 1.5m3-3l-1.5 1.5m3-3l-1.5 1.5" />
        </svg>
    );

    const SnowIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M12 15.75l.75-.75m-.75.75l-.75-.75m.75.75v1.5m-3-3.75l.75-.75m-.75.75l-.75-.75m.75.75v1.5m6-1.5l.75-.75m-.75.75l-.75-.75m.75.75v1.5" />
        </svg>
    );

    const ThunderstormIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M11.25 18.75l-1.5-3h3.75l-1.5 4.5v-3h-1.5z" />
        </svg>
    );

    const FogIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 16.5h16.5M3.75 18.75h16.5" />
        </svg>
    );


    const SettingsIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.438.995s.145.755.438.995l1.003.827c.48.398.668 1.03.26 1.431l-1.296 2.247a1.125 1.125 0 01-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.075.124a6.57 6.57 0 01-.22.127c-.331.183-.581.495-.645.87l-.213 1.281c-.09.543-.56.94-1.11.94h-2.593c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 01-.22-.127c-.324-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 01-1.37-.49l-1.296-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.437-.995s-.145-.755-.437-.995l-1.004-.827a1.125 1.125 0 01-.26-1.431l1.296-2.247a1.125 1.125 0 011.37-.49l1.217.456c.355.133.75.072 1.075-.124.072-.044.146-.087.22-.127.332-.183.582-.495.645-.87l.213-1.281z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    );

    const CloseIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
    );

    const TrashIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.124-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.077-2.09.921-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
        </svg>
    );

    const LocationMarkerIcon = ({ className }) => (
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className={className || "w-6 h-6"}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
            <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
        </svg>
    );
    // =================================================================================
    // END: components/Icons.tsx
    // =================================================================================

    // =================================================================================
    // START: components/WeatherIcon.tsx
    // =================================================================================
    const WeatherIcon = ({ code, description }) => {
        const codeNum = parseInt(code, 10);
        let IconComponent = CloudyIcon;
        let iconColor = 'text-gray-300 dark:text-gray-400';

        if (codeNum === 113) { // Sunny/Clear
            IconComponent = SunIcon;
            iconColor = 'text-yellow-300';
        } else if (codeNum === 116) { // Partly Cloudy
            IconComponent = PartlyCloudyIcon;
            iconColor = 'text-gray-200';
        } else if (codeNum === 119 || codeNum === 122) { // Cloudy & Overcast
            IconComponent = CloudyIcon;
            iconColor = 'text-gray-400';
        } else if ([143, 248, 260].includes(codeNum)) { // Mist, Fog
            IconComponent = FogIcon;
            iconColor = 'text-gray-400';
        } else if (codeNum >= 200 && codeNum <= 395 && description.toLowerCase().includes('thunder')) { // Thunder
            IconComponent = ThunderstormIcon;
            iconColor = 'text-yellow-400';
        } else if ([179, 182, 227, 230, 317, 320, 323, 326, 329, 332, 335, 338, 350, 362, 365, 368, 371, 374, 377, 392, 395].includes(codeNum)) { // Snow/Sleet/Ice
            IconComponent = SnowIcon;
            iconColor = 'text-white';
        } else if ([176, 185, 263, 266, 281, 284, 293, 296, 299, 302, 305, 308, 311, 314, 353, 356, 359, 386, 389].includes(codeNum)) { // Rain/Drizzle
            IconComponent = RainIcon;
            iconColor = 'text-blue-300';
        }

        return (
            <div title={description}>
                <IconComponent className={`w-10 h-10 ${iconColor}`} />
            </div>
        );
    };
    // =================================================================================
    // END: components/WeatherIcon.tsx
    // =================================================================================
    
    // =================================================================================
    // START: components/Clock.tsx
    // =================================================================================
    const Clock = () => {
        const [time, setTime] = useState(new Date());

        useEffect(() => {
            const timerId = setInterval(() => {
                setTime(new Date());
            }, 1000);

            return () => {
                clearInterval(timerId);
            };
        }, []);

        return (
            <div className="text-center">
                <h1 className="text-6xl sm:text-7xl md:text-8xl font-bold tracking-tight text-white text-shadow-lg" style={{textShadow: '0 2px 10px rgba(0,0,0,0.5)'}}>
                    {time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true })}
                </h1>
                <p className="text-base md:text-lg mt-2 opacity-90 text-white font-medium" style={{textShadow: '0 1px 5px rgba(0,0,0,0.5)'}}>
                    {time.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                </p>
            </div>
        );
    };
    // =================================================================================
    // END: components/Clock.tsx
    // =================================================================================

    // =================================================================================
    // START: components/SettingsPanel.tsx
    // =================================================================================
    const SettingsPanel = ({ theme, onThemeToggle, onOpenSettings }) => {
        return (
            <div className="absolute top-4 right-4 z-20 flex items-center space-x-2 p-2 rounded-full bg-white/20 dark:bg-black/20 backdrop-blur-md border border-white/30 dark:border-white/10 shadow-lg">
                <button
                    onClick={onThemeToggle}
                    className="p-2 rounded-full text-white hover:bg-white/30 dark:hover:bg-black/30 transition-colors"
                    aria-label="Toggle theme"
                >
                    {theme === 'light' ? <MoonIcon className="w-5 h-5" /> : <SunIcon className="w-5 h-5" />}
                </button>

                <button
                    onClick={onOpenSettings}
                    className="p-2 rounded-full text-white hover:bg-white/30 dark:hover:bg-black/30 transition-colors"
                    aria-label="Open settings"
                >
                    <SettingsIcon className="w-5 h-5" />
                </button>
            </div>
        );
    };
    // =================================================================================
    // END: components/SettingsPanel.tsx
    // =================================================================================
    
    // =================================================================================
    // START: components/SearchBar.tsx
    // =================================================================================
    const SearchBar = ({ currentEngine, onSearchEngineChange, onSearch, searchHistory, onClearHistory }) => {
        const [query, setQuery] = useState('');
        const [isHistoryVisible, setIsHistoryVisible] = useState(false);

        const handleSubmit = (e) => {
            e.preventDefault();
            if(query.trim()){
              onSearch(query);
            }
        };
        
        const renderEngineIcon = () => {
            if (!currentEngine) return <SearchIcon className="w-5 h-5" />;
            
            const engineName = currentEngine.name.toLowerCase();
            if (engineName === 'google') return <GoogleIcon className="w-5 h-5" />;
            if (engineName === 'bing') return <BingIcon className="w-5 h-5" />;

            try {
                const url = new URL(currentEngine.urlTemplate);
                const faviconUrl = `https://www.google.com/s2/favicons?sz=32&domain_url=${url.hostname}`;
                return <img src={faviconUrl} alt={`${currentEngine.name} icon`} className="w-5 h-5 rounded-sm object-contain" />;
            } catch (error) {
                console.warn(`Could not generate favicon for "${currentEngine.name}"`, error);
                return <SearchIcon className="w-5 h-5" />;
            }
        };

        const handleHistoryClick = (term) => {
          setQuery(term);
          onSearch(term);
        }

        return (
            <div className="w-full mt-8 relative">
                <form onSubmit={handleSubmit} className="w-full">
                    <div className="relative flex items-center w-full">
                        <button
                            type="button"
                            onClick={onSearchEngineChange}
                            className="absolute left-0 top-1/2 -translate-y-1/2 p-3 text-white/80 hover:text-white transition-colors focus:outline-none rounded-full"
                            aria-label={`Switch search engine. Current: ${currentEngine?.name}`}
                            title={`Current engine: ${currentEngine?.name}`}
                        >
                            {renderEngineIcon()}
                        </button>
                        <input
                            type="text"
                            value={query}
                            onChange={(e) => setQuery(e.target.value)}
                            onFocus={() => setIsHistoryVisible(true)}
                            onBlur={() => setTimeout(() => setIsHistoryVisible(false), 200)}
                            placeholder="Search the web or type a URL"
                            className="w-full h-14 bg-white/10 dark:bg-black/10 text-white placeholder-white/60 pl-14 pr-14 py-2 rounded-full border border-transparent focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all text-lg"
                            aria-label="Search input"
                            autoComplete="off"
                            autoFocus
                        />
                        <button
                            type="submit"
                            className="absolute right-0 top-1/2 -translate-y-1/2 p-4 text-white/80 hover:text-white transition-colors focus:outline-none rounded-full"
                            aria-label="Search"
                        >
                            <SearchIcon className="w-5 h-5" />
                        </button>
                    </div>
                </form>
                {isHistoryVisible && searchHistory.length > 0 && (
                    <div className="absolute top-full mt-2 w-full bg-white/20 dark:bg-black/20 backdrop-blur-lg border border-white/30 dark:border-white/10 rounded-2xl shadow-lg z-20 overflow-hidden">
                        <ul className="py-2">
                           {searchHistory.map((term, index) => (
                               <li key={index}>
                                   <button 
                                      className="w-full text-left px-4 py-2 text-white hover:bg-white/10 transition-colors"
                                      onMouseDown={() => handleHistoryClick(term)}
                                    >
                                       {term}
                                   </button>
                               </li>
                           ))}
                        </ul>
                        <div className="border-t border-white/20 px-4 py-2">
                           <button 
                              className="text-sm text-white/70 hover:text-white transition-colors"
                              onClick={onClearHistory}
                            >
                               Clear history
                           </button>
                        </div>
                    </div>
                )}
            </div>
        );
    };
    // =================================================================================
    // END: components/SearchBar.tsx
    // =================================================================================

    // =================================================================================
    // START: components/WeatherWidget.tsx
    // =================================================================================
    const WeatherWidget = ({ 
        locationLabel, 
        onLocationChange, 
        onRequestGeolocation,
        weatherData, 
        weatherError,
        unit,
    }) => {
        const [isEditing, setIsEditing] = useState(false);
        const [inputValue, setInputValue] = useState(locationLabel);

        useEffect(() => {
            if (!isEditing) {
                setInputValue(locationLabel);
            }
        }, [locationLabel, isEditing]);

        const handleFormSubmit = (e) => {
            e.preventDefault();
            const trimmedValue = inputValue.trim();
            if (trimmedValue && trimmedValue !== locationLabel) {
                onLocationChange(trimmedValue);
            }
            setIsEditing(false);
        };

        const handleBlur = () => {
            const trimmedValue = inputValue.trim();
            if (trimmedValue && trimmedValue !== locationLabel) {
                onLocationChange(trimmedValue);
            }
            setIsEditing(false);
        };

        const renderContent = () => {
            if (weatherError) {
                return <p className="text-sm text-red-300">{weatherError}</p>;
            }
            if (!weatherData) {
                return <p className="text-sm animate-pulse">Loading weather...</p>;
            }

            const current = weatherData.current_condition[0];
            const temp = unit === 'F' ? current.temp_F : current.temp_C;
            const feelsLike = unit === 'F' ? current.FeelsLikeF : current.FeelsLikeC;

            return (
                <div className="flex items-center space-x-3">
                    <WeatherIcon code={current.weatherCode} description={current.weatherDesc[0].value} />
                    <div>
                        <p className="font-bold text-2xl" style={{ textShadow: '0 1px 3px rgba(0,0,0,0.5)' }}>{temp}째{unit}</p>
                        <p className="text-xs -mt-1 opacity-90">Feels like {feelsLike}째</p>
                    </div>
                </div>
            );
        };
        
        const area = weatherData?.nearest_area?.[0];
        const displayName = area ? `${area.areaName[0].value}, ${area.country[0].value}` : (locationLabel || 'Set Location');

        return (
            <div className="absolute top-4 left-4 p-3 rounded-2xl bg-white/20 dark:bg-black/20 backdrop-blur-md border border-white/30 dark:border-white/10 shadow-lg text-white transition-all duration-300">
                <div className="flex flex-col">
                    <div className="flex items-center space-x-2">
                        {isEditing ? (
                            <form onSubmit={handleFormSubmit}>
                                <input
                                    type="text"
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    onBlur={handleBlur}
                                    className="bg-transparent text-sm font-semibold outline-none border-b border-white/50 focus:border-white w-28 placeholder-white/70"
                                    placeholder="Enter City"
                                    aria-label="Enter location for weather"
                                    autoFocus
                                />
                            </form>
                        ) : (
                            <button onClick={() => setIsEditing(true)} className="text-sm font-semibold text-left hover:opacity-80 transition-opacity" title="Click to change location">
                                {displayName}
                            </button>
                        )}
                         <button onClick={onRequestGeolocation} className="text-white/80 hover:text-white transition-opacity" title="Use current location" aria-label="Use current location">
                            <LocationMarkerIcon className="w-4 h-4" />
                        </button>
                    </div>
                    <div className="mt-2 h-12 flex items-center">
                        {renderContent()}
                    </div>
                </div>
            </div>
        );
    };
    // =================================================================================
    // END: components/WeatherWidget.tsx
    // =================================================================================
    
    // =================================================================================
    // START: components/SettingsModal.tsx
    // =================================================================================
    const SettingsModal = ({ 
        isOpen, 
        onClose,
        onLocalWallpaperSelect,
        onBingWallpaperSelect,
        searchEngines,
        onAddSearchEngine,
        onRemoveSearchEngine,
        temperatureUnit,
        onTemperatureUnitChange,
        wallpaperBlur,
        onWallpaperBlurChange
    }) => {
        const fileInputRef = useRef(null);
        const [newEngineName, setNewEngineName] = useState('');
        const [newEngineUrl, setNewEngineUrl] = useState('');

        if (!isOpen) return null;

        const handleUploadClick = () => {
            fileInputRef.current?.click();
        };

        const handleAddEngine = (e) => {
            e.preventDefault();
            onAddSearchEngine({ name: newEngineName, urlTemplate: newEngineUrl });
            setNewEngineName('');
            setNewEngineUrl('');
        };

        const activeUnitClasses = 'bg-white/30';
        const inactiveUnitClasses = 'bg-white/10 hover:bg-white/20';

        return (
            <div 
                className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity"
                onClick={onClose}
                aria-modal="true"
                role="dialog"
            >
                <div 
                    className="relative p-8 rounded-2xl bg-white/20 dark:bg-black/20 backdrop-blur-xl border border-white/30 dark:border-white/10 shadow-2xl w-full max-w-md text-white transition-all"
                    onClick={e => e.stopPropagation()}
                >
                    <button 
                        onClick={onClose} 
                        className="absolute top-4 right-4 p-2 rounded-full text-white/70 hover:bg-white/20 hover:text-white"
                        aria-label="Close settings"
                    >
                        <CloseIcon className="w-5 h-5" />
                    </button>
                    
                    <h2 className="text-2xl font-bold mb-6">Settings</h2>

                    {/* Wallpaper Settings */}
                    <div className="mb-6">
                        <h3 className="text-lg font-semibold mb-3 border-b border-white/20 pb-2">Wallpaper</h3>
                        <div className="flex space-x-4">
                            <input
                                type="file"
                                ref={fileInputRef}
                                onChange={onLocalWallpaperSelect}
                                className="hidden"
                                accept="image/*"
                            />
                            <button
                                onClick={handleUploadClick}
                                className="flex-1 flex items-center justify-center space-x-2 p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-colors"
                            >
                                <UploadIcon className="w-5 h-5" />
                                <span>Upload Local</span>
                            </button>
                            <button
                                onClick={onBingWallpaperSelect}
                                className="flex-1 flex items-center justify-center space-x-2 p-3 rounded-lg bg-white/10 hover:bg-white/20 transition-colors"
                            >
                                <BingIcon className="w-5 h-5" />
                                <span>Use Bing Daily</span>
                            </button>
                        </div>
                        <div className="mt-4">
                            <label htmlFor="wallpaper-blur" className="font-medium mb-2 block">Background Blur</label>
                            <div className="flex items-center space-x-3">
                               <input
                                    id="wallpaper-blur"
                                    type="range"
                                    min="0"
                                    max="24"
                                    step="1"
                                    value={wallpaperBlur}
                                    onChange={(e) => onWallpaperBlurChange(parseInt(e.target.value, 10))}
                                    className="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer accent-white"
                                />
                                <span className="text-sm font-mono w-8 text-center">{wallpaperBlur}px</span>
                            </div>
                        </div>
                    </div>

                    {/* Weather Settings */}
                    <div className="mb-8">
                        <h3 className="text-lg font-semibold mb-3 border-b border-white/20 pb-2">Weather</h3>
                         <div className="flex items-center justify-between">
                            <label htmlFor="temp-unit" className="font-medium">Temperature Unit</label>
                            <div className="flex rounded-lg p-1 bg-black/20">
                                <button 
                                    onClick={() => onTemperatureUnitChange('F')}
                                    className={`px-4 py-1 rounded-md text-sm font-semibold transition-colors ${temperatureUnit === 'F' ? activeUnitClasses : inactiveUnitClasses}`}
                                    aria-pressed={temperatureUnit === 'F'}
                                >
                                    째F
                                </button>
                                <button 
                                    onClick={() => onTemperatureUnitChange('C')}
                                    className={`px-4 py-1 rounded-md text-sm font-semibold transition-colors ${temperatureUnit === 'C' ? activeUnitClasses : inactiveUnitClasses}`}
                                    aria-pressed={temperatureUnit === 'C'}
                                >
                                    째C
                                </button>
                            </div>
                        </div>
                    </div>


                    {/* Search Engine Settings */}
                    <div>
                        <h3 className="text-lg font-semibold mb-3 border-b border-white/20 pb-2">Search Engines</h3>
                        <div className="space-y-2 max-h-40 overflow-y-auto pr-2">
                            {searchEngines.map((engine, index) => (
                                <div key={index} className="flex items-center justify-between p-2 rounded-md bg-white/5">
                                    <span className="font-medium">{engine.name}</span>
                                    <button 
                                        onClick={() => onRemoveSearchEngine(index)}
                                        className="p-1 text-red-400 hover:text-red-300 hover:bg-white/10 rounded-full"
                                        aria-label={`Remove ${engine.name}`}
                                    >
                                        <TrashIcon className="w-4 h-4" />
                                    </button>
                                </div>
                            ))}
                        </div>

                        <form onSubmit={handleAddEngine} className="mt-4 pt-4 border-t border-white/20">
                            <h4 className="font-semibold mb-2">Add New Engine</h4>
                            <div className="space-y-3">
                                <input 
                                    type="text"
                                    value={newEngineName}
                                    onChange={e => setNewEngineName(e.target.value)}
                                    placeholder="Name (e.g., DuckDuckGo)"
                                    className="w-full p-2 rounded-md bg-white/10 placeholder-white/50 border border-transparent focus:outline-none focus:border-white/50"
                                    required
                                />
                                <input 
                                    type="text"
                                    value={newEngineUrl}
                                    onChange={e => setNewEngineUrl(e.target.value)}
                                    placeholder="URL with %s (e.g., https://duckduckgo.com/?q=%s)"
                                    className="w-full p-2 rounded-md bg-white/10 placeholder-white/50 border border-transparent focus:outline-none focus:border-white/50"
                                    required
                                />
                            </div>
                            <button type="submit" className="w-full mt-3 p-2 rounded-lg bg-blue-500/50 hover:bg-blue-500/70 transition-colors font-semibold">
                                Add Engine
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        );
    };
    // =================================================================================
    // END: components/SettingsModal.tsx
    // =================================================================================

    // =================================================================================
    // START: App.tsx
    // =================================================================================
    const DEFAULT_SEARCH_ENGINES = [
        { name: 'Bing', urlTemplate: 'https://www.bing.com/search?q=%s' },
        { name: 'Google', urlTemplate: 'https://www.google.com/search?q=%s' },
    ];

    const App = () => {
        const [theme, setTheme] = useState(() => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light' || savedTheme === 'dark') {
                return savedTheme;
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        });
        
        const [temperatureUnit, setTemperatureUnit] = useState(
            () => (localStorage.getItem('temperatureUnit')) || 'F'
        );

        const [wallpaperUrl, setWallpaperUrl] = useState(localStorage.getItem('wallpaperUrl'));
        const [wallpaperBlur, setWallpaperBlur] = useState(() => {
            const savedBlur = localStorage.getItem('wallpaperBlur');
            return savedBlur ? parseInt(savedBlur, 10) : 8;
        });
        const [isLoading, setIsLoading] = useState(!wallpaperUrl);
        const [wallpaperInfo, setWallpaperInfo] = useState('');
        
        const [searchEngines, setSearchEngines] = useState(() => {
            const savedEngines = localStorage.getItem('searchEngines');
            try {
                if (savedEngines) {
                    const parsed = JSON.parse(savedEngines);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        return parsed;
                    }
                }
            } catch (e) {
                console.error("Failed to parse search engines from localStorage", e);
            }
            return DEFAULT_SEARCH_ENGINES;
        });

        const [currentSearchEngineIndex, setCurrentSearchEngineIndex] = useState(() => {
            const savedIndex = localStorage.getItem('currentSearchEngineIndex');
            return savedIndex ? parseInt(savedIndex, 10) : 0;
        });
        
        const [searchHistory, setSearchHistory] = useState(() => {
            const savedHistory = localStorage.getItem('searchHistory');
            return savedHistory ? JSON.parse(savedHistory) : [];
        });

        const [location, setLocation] = useState(() => localStorage.getItem('weatherLocation') || '');
        const [locationLabel, setLocationLabel] = useState(() => localStorage.getItem('weatherLocationLabel') || '');

        const [weatherData, setWeatherData] = useState(null);
        const [weatherError, setWeatherError] = useState(null);
        const [isSettingsModalOpen, setIsSettingsModalOpen] = useState(false);


        const fetchBingWallpaper = useCallback(async () => {
            setIsLoading(true);
            setWallpaperInfo('Fetching Bing daily wallpaper...');
            try {
                const proxyUrl = 'https://corsproxy.io/?';
                const bingApiUrl = 'https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=en-US';
                const response = await fetch(`${proxyUrl}${encodeURIComponent(bingApiUrl)}`);
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                const data = await response.json();
                const imageUrl = `https://www.bing.com${data.images[0].url}`;
                setWallpaperUrl(imageUrl);
                setWallpaperInfo(data.images[0].copyright);
                localStorage.removeItem('wallpaperUrl'); 
            } catch (error) {
                console.error("Failed to fetch Bing wallpaper:", error);
                setWallpaperUrl('https://picsum.photos/1920/1080'); // Fallback
                setWallpaperInfo('Failed to load Bing wallpaper. Showing a random image.');
            } finally {
                setIsLoading(false);
            }
        }, []);

        const requestGeolocation = useCallback(() => {
            if (!navigator.geolocation) {
                setWeatherError("Geolocation is not supported.");
                return;
            }
            setWeatherData(null);
            setWeatherError(null);
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    const newLocation = `${latitude},${longitude}`;
                    const newLocationLabel = 'Current Location';
                    localStorage.setItem('weatherLocation', newLocation);
                    localStorage.setItem('weatherLocationLabel', newLocationLabel);
                    setLocation(newLocation);
                    setLocationLabel(newLocationLabel);
                },
                () => {
                    setWeatherError("Location access denied.");
                    if (!localStorage.getItem('weatherLocation')) {
                        const defaultLocation = 'New York';
                        localStorage.setItem('weatherLocation', defaultLocation);
                        localStorage.setItem('weatherLocationLabel', defaultLocation);
                        setLocation(defaultLocation);
                        setLocationLabel(defaultLocation);
                    }
                }
            );
        }, []);

        useEffect(() => {
            const root = window.document.documentElement;
            if (theme === 'dark') {
                root.classList.add('dark');
            } else {
                root.classList.remove('dark');
            }
            localStorage.setItem('theme', theme);
        }, [theme]);
        
        useEffect(() => {
            localStorage.setItem('temperatureUnit', temperatureUnit);
        }, [temperatureUnit]);
        
        useEffect(() => {
            localStorage.setItem('wallpaperBlur', wallpaperBlur.toString());
        }, [wallpaperBlur]);

        useEffect(() => {
            localStorage.setItem('searchEngines', JSON.stringify(searchEngines));
            if (currentSearchEngineIndex >= searchEngines.length) {
                setCurrentSearchEngineIndex(0);
            }
        }, [searchEngines, currentSearchEngineIndex]);

        useEffect(() => {
            localStorage.setItem('currentSearchEngineIndex', currentSearchEngineIndex.toString());
        }, [currentSearchEngineIndex]);

        useEffect(() => {
            if (!wallpaperUrl) {
                fetchBingWallpaper();
            } else {
                if (wallpaperUrl.startsWith('data:image')) {
                    setWallpaperInfo('Local wallpaper');
                } else {
                    setWallpaperInfo(''); 
                }
                setIsLoading(false);
            }
            // eslint-disable-next-line react-hooks/exhaustive-deps
        }, []);
        
        useEffect(() => {
            const savedLocation = localStorage.getItem('weatherLocation');
            if (savedLocation) {
                setLocation(savedLocation);
                setLocationLabel(localStorage.getItem('weatherLocationLabel') || savedLocation);
            } else {
                requestGeolocation();
            }
        }, [requestGeolocation]);
        
        useEffect(() => {
            if (!location) return;

            const fetchWeatherData = async () => {
                setWeatherData(null);
                setWeatherError(null);
                try {
                    const response = await fetch(`https://wttr.in/${encodeURIComponent(location)}?format=j1`);
                    if (!response.ok) {
                        throw new Error('Location not found or API error.');
                    }
                    const data = await response.json();
                    if (data.current_condition) {
                        setWeatherData(data);
                    } else {
                        throw new Error('Invalid location data.');
                    }
                } catch (error) {
                    console.error("Failed to fetch weather:", error);
                    setWeatherError('Could not get weather.');
                }
            };

            fetchWeatherData();
        }, [location]);

        const handleThemeToggle = () => {
            setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
        };
        
        const handleTemperatureUnitChange = (unit) => {
            setTemperatureUnit(unit);
        };
        
        const handleWallpaperBlurChange = (blur) => {
            setWallpaperBlur(blur);
        };

        const handleLocationChange = (newLocation) => {
            const trimmed = newLocation.trim();
            if(trimmed) {
                localStorage.setItem('weatherLocation', trimmed);
                localStorage.setItem('weatherLocationLabel', trimmed);
                setLocation(trimmed);
                setLocationLabel(trimmed);
            }
        };

        const handleLocalWallpaperSelect = (event) => {
            const file = event.target.files?.[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const result = e.target?.result;
                    setWallpaperUrl(result);
                    localStorage.setItem('wallpaperUrl', result);
                    setWallpaperInfo(file.name);
                };
                reader.readAsDataURL(file);
            }
        };

        const handleSearchEngineChange = () => {
            setCurrentSearchEngineIndex(prevIndex => (prevIndex + 1) % searchEngines.length);
        };
        
        const handleAddSearchEngine = (engine) => {
            if (engine.name.trim() && engine.urlTemplate.trim().includes('%s')) {
                setSearchEngines(prev => [...prev, engine]);
            } else {
                alert('Invalid search engine. Please provide a name and a URL template containing "%s".');
            }
        };
        
        const handleRemoveSearchEngine = (indexToRemove) => {
            setSearchEngines(prev => prev.filter((_, index) => index !== indexToRemove));
        };

        const handleSearch = (query) => {
            if (!query.trim()) return;

            const updatedHistory = [query, ...searchHistory.filter(item => item !== query)].slice(0, 5);
            setSearchHistory(updatedHistory);
            localStorage.setItem('searchHistory', JSON.stringify(updatedHistory));

            const isUrl = (text) => {
                if ((text.includes('.') && !text.includes(' ')) || text.startsWith('localhost:')) {
                    return true;
                }
                try {
                    new URL(text);
                    return true;
                } catch (_) {
                    return false;
                }
            };

            if (isUrl(query)) {
                let url = query;
                if (query.startsWith('localhost:')) {
                     url = `http://${query}`;
                } else if (!query.startsWith('http://') && !query.startsWith('https://')) {
                     url = `https://${query}`;
                }
                window.location.href = url;
            } else {
                const currentEngine = searchEngines[currentSearchEngineIndex];
                const searchUrl = currentEngine.urlTemplate.replace('%s', encodeURIComponent(query));
                window.location.href = searchUrl;
            }
        };

        const handleClearHistory = () => {
            setSearchHistory([]);
            localStorage.removeItem('searchHistory');
        };
        
        return (
            <main className="relative h-screen w-screen overflow-hidden text-slate-800 dark:text-white transition-colors duration-500">
                <div
                    className="absolute inset-0 bg-cover bg-center transition-all duration-300"
                    style={{
                        backgroundImage: wallpaperUrl ? `url(${wallpaperUrl})` : 'none',
                        backgroundColor: theme === 'dark' ? '#111827' : '#f9fafb',
                        filter: `blur(${wallpaperBlur}px)`,
                        transform: `scale(${1 + wallpaperBlur / 100})`, // Scale up to avoid sharp edges from blur
                    }}
                />
                
                {isLoading && (
                    <div className="absolute inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
                        <div className="text-white text-2xl animate-pulse">Loading...</div>
                    </div>
                )}
                
                <div className="absolute inset-0 bg-black bg-opacity-20 dark:bg-opacity-30 transition-opacity" />
                
                <WeatherWidget
                    locationLabel={locationLabel}
                    onLocationChange={handleLocationChange}
                    onRequestGeolocation={requestGeolocation}
                    weatherData={weatherData}
                    weatherError={weatherError}
                    unit={temperatureUnit}
                />

                <div className="relative z-10 flex flex-col items-center justify-center h-full w-full p-4">
                    <div className="p-8 md:p-12 rounded-2xl bg-white/20 dark:bg-black/20 backdrop-blur-xl border border-white/30 dark:border-white/10 shadow-2xl w-full max-w-2xl transition-all duration-300">
                        <Clock />
                        <SearchBar 
                            currentEngine={searchEngines[currentSearchEngineIndex]}
                            onSearchEngineChange={handleSearchEngineChange}
                            onSearch={handleSearch}
                            searchHistory={searchHistory}
                            onClearHistory={handleClearHistory}
                        />
                    </div>
                </div>

                <SettingsPanel 
                    theme={theme} 
                    onThemeToggle={handleThemeToggle}
                    onOpenSettings={() => setIsSettingsModalOpen(true)}
                />
                
                <SettingsModal 
                    isOpen={isSettingsModalOpen}
                    onClose={() => setIsSettingsModalOpen(false)}
                    onLocalWallpaperSelect={handleLocalWallpaperSelect}
                    onBingWallpaperSelect={fetchBingWallpaper}
                    searchEngines={searchEngines}
                    onAddSearchEngine={handleAddSearchEngine}
                    onRemoveSearchEngine={handleRemoveSearchEngine}
                    temperatureUnit={temperatureUnit}
                    onTemperatureUnitChange={handleTemperatureUnitChange}
                    wallpaperBlur={wallpaperBlur}
                    onWallpaperBlurChange={handleWallpaperBlurChange}
                />

                {wallpaperInfo && (
                    <div className="absolute bottom-4 left-4 text-white text-sm bg-black/40 p-2 rounded-md backdrop-blur-sm max-w-xs md:max-w-md text-ellipsis overflow-hidden whitespace-nowrap">
                        {wallpaperInfo}
                    </div>
                )}
            </main>
        );
    };
    // =================================================================================
    // END: App.tsx
    // =================================================================================

    // =================================================================================
    // START: index.tsx (Main render call)
    // =================================================================================
    const rootElement = document.getElementById('root');
    if (!rootElement) {
      throw new Error("Could not find root element to mount to");
    }

    const root = ReactDOM.createRoot(rootElement);
    root.render(
      <React.StrictMode>
        <App />
      </React.StrictMode>
    );
    // =================================================================================
    // END: index.tsx
    // =================================================================================

  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(registration => {
          console.log('SW registered: ', registration);
        }).catch(registrationError => {
          console.log('SW registration failed: ', registrationError);
        });
      });
    }
  </script>
</body>
</html>